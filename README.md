# Домашнее задание к занятию "08.04 Создание собственных modules"

## Подготовка к выполнению
1. Создайте пустой публичных репозиторий в любом своём проекте: `my_own_collection`
2. Скачайте репозиторий ansible: `git clone https://github.com/ansible/ansible.git` по любому удобному вам пути
3. Зайдите в директорию ansible: `cd ansible`
4. Создайте виртуальное окружение: `python3 -m venv venv`
5. Активируйте виртуальное окружение: `. venv/bin/activate`. Дальнейшие действия производятся только в виртуальном окружении
6. Установите зависимости `pip install -r requirements.txt`
7. Запустить настройку окружения `. hacking/env-setup`
8. Если все шаги прошли успешно - выйти из виртуального окружения `deactivate`
9. Ваше окружение настроено, для того чтобы запустить его, нужно находиться в директории `ansible` и выполнить конструкцию `. venv/bin/activate && . hacking/env-setup`

### Ответ: подготовка выполнена.

## Основная часть

Наша цель - написать собственный module, который мы можем использовать в своей role, через playbook. Всё это должно быть собрано в виде collection и отправлено в наш репозиторий.

### 1. В виртуальном окружении создать новый `my_own_module.py` файл
### 2. Наполнить его содержимым из [статьи](https://docs.ansible.com/ansible/latest/dev_guide/developing_modules_general.html#creating-a-module).

### Сделано: 

![image](https://user-images.githubusercontent.com/92969676/176424332-d9147ecf-a14e-47a6-83a4-6729a5b971a8.png)

### 3. Заполните файл в соответствии с требованиями ansible так, чтобы он выполнял основную задачу: module должен создавать текстовый файл на удалённом хосте по пути, определённом в параметре `path`, с содержимым, определённым в параметре `content`.

### Сделано: 

![image](https://user-images.githubusercontent.com/92969676/176425358-effc1ad6-13b5-4e19-92ce-2e769d99610f.png)

определили 3 аргумента: file_name, path и content.

Далее по правилам создания модуля указали полный путь до файла в переменной: ```full_path_file = module.params['path']+ '/' + module.params['file_name']```

Далее на python создали конструкцию, которая: 

*1 проверяет существования пути файла (с учетов того, что у меня в полном пути используется и название файла, то проверка существования самого файла - не имеет смысла). Тем самым я проверяю при помощи функции os.path.exists(full_path_file) сущестовование файла с путём.

*2 если путь с файлом существует - то прост овыводим информацию, что файл уже существует.

*3 в противном случае создаем файл и открываем его на запись.

*4 далее проверяем на существование самой переменной content в которой далее будемпередавать содержимое в файл.

*5 если переменная существует, то дописываем содержимое из переменной content в файл и закрываем его с информацией, что файл создан.

### 5. Проверьте module на исполняемость локально.

### Ответ: модуль исполняется:

![image](https://user-images.githubusercontent.com/92969676/176427769-d8bebb97-c8eb-49d5-9ca2-854a0cdfb994.png)

### 6. Напишите single task playbook и используйте module в нём.

### Сделано:
![image](https://user-images.githubusercontent.com/92969676/176426758-987ebc9d-9f41-4992-86f2-11605faf09c0.png)

### 7. Проверьте через playbook на идемпотентность.

### Сделано: 

![image](https://user-images.githubusercontent.com/92969676/176426846-3a250505-cba2-4c4d-94ae-c63ccb5b18f0.png)

### 8. Выйдите из виртуального окружения.
### 9. Инициализируйте новую collection: `ansible-galaxy collection init my_own_namespace.yandex_cloud_elk`

![image](https://user-images.githubusercontent.com/92969676/176427023-490a10b7-0f11-47d0-9520-d8e186daa782.png)

### 10. В данную collection перенесите свой module в соответствующую директорию.

![image](https://user-images.githubusercontent.com/92969676/176427482-544d652a-a7df-4c34-9252-48180fd93be4.png)

### 11. Single task playbook преобразуйте в single task role и перенесите в collection. У role должны быть default всех параметров module
### 12. Создайте playbook для использования этой role.
### 13. Заполните всю документацию по collection, выложите в свой репозиторий, поставьте тег `1.0.0` на этот коммит.
### 14. Создайте .tar.gz этой collection: `ansible-galaxy collection build` в корневой директории collection.
### 15. Создайте ещё одну директорию любого наименования, перенесите туда single task playbook и архив c collection.
### 16. Установите collection из локального архива: `ansible-galaxy collection install <archivename>.tar.gz`
### 17. Запустите playbook, убедитесь, что он работает.
### 18. В ответ необходимо прислать ссылку на репозиторий с collection
